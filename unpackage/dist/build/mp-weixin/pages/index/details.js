(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/details"],{"20a1":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=getApp(),i={data:function(){return{template:t.getStorageSync("__ddminiTemplateConfig"),goodsId:"",goodsDetail:"",swiperCurrent:0,tagStyle:{img:"display:block"},timeData:{},selectSpecsChild:"",selectSpecsChildInto:"",selectSpecsChildIndex:0,buyNumMax:0,cartNumber:0,shareShow:!1,shareCoverShow:!1,pintuanConfig:"",pintuanGoodsList:[],buyNumber:0,userInfoData:""}},onLoad:function(t){var e=this;e.goodsId=t.id,e.getGoodsDetail(),e.getCartList(),e.getUserInfo()},onShareAppMessage:function(){var t=this,e=t.goodsDetail,n=t.userInfoData;t.shareShow=!1;var i="/pages/index/index?goods=".concat(e.id);return n.profitsharing&&(i="/pages/index/index?goods=".concat(e.id,"&fenz=").concat(n.id)),{title:e.title,imageUrl:e.pic_list[0].pic,path:i}},onShareTimeline:function(){},methods:{getUserInfo:function(){var t=this;t.Get(t.Url.userInfo).then((function(e){0===e.code&&(t.userInfoData=e.data)}))},onChange:function(t){this.timeData=t},getFavoriteAdd:function(){var e=this;if(n.globalData.user){var i={id:e.goodsDetail.id,type:!e.goodsDetail.fav_status};e.Get(e.Url.favoriteAdd,i).then((function(n){0===n.code&&(e.goodsDetail.fav_status=!e.goodsDetail.fav_status,t.showToast({title:e.goodsDetail.fav_status?"收藏成功":"取消收藏"}))}))}else t.navigateTo({url:"/pages/user/login"})},getCartList:function(){var t=this;t.Get(t.Url.cartList).then((function(e){if(0===e.code){var n=0;e.data.forEach((function(t){n+=t.num})),t.cartNumber=n}}))},getGoodsDetail:function(){var e=this;t.showLoading({title:"商品加载中",mask:!0}),e.Get(e.Url.goodsDetail,{id:e.goodsId}).then((function(n){if(0===n.code){t.hideLoading();var i=n.data;if(i.shelf_down_time_stamp){var o=(new Date).getTime();i.buyEndTime=i.shelf_down_time_stamp-o}t.setNavigationBarTitle({title:i.title}),i.stock_number&&(e.buyNumber=1),e.goodsDetail=i,i.specs_list&&e.getSpecsImage(),i.pintuan_id&&(e.getPintuanConfig(),e.getPintuanGoods())}else t.hideLoading(),t.showModal({content:"商品不存在",showCancel:!1,success:function(e){e.confirm&&t.navigateBack()}})}))},getPintuanConfig:function(){var t=this,e={goods_id:t.goodsDetail.id};t.Get(t.Url.pintuanConfig,e).then((function(e){0===e.code&&(t.pintuanConfig=e.data)}))},getPintuanGoods:function(){var t=this,e={goods_id:t.goodsDetail.id};t.Get(t.Url.pintuanGoods,e).then((function(e){0===e.code&&(t.pintuanGoodsList=e.data.list)}))},getSpecsImage:function(){var t=this,e=t.goodsDetail;e.specs_list.childProductArray.forEach((function(t){var e=Object.entries(t.child_product_spec)[0];t.child_product_key=e[0],t.child_product_value=e[1]})),t.goodsDetail=e},selectChildTap:function(t,e){var n=this;if(n.selectSpecsChild=t,n.selectSpecsChildIndex<e?n.selectSpecsChildInto="to_"+(e-1):n.selectSpecsChildInto="to_".concat(e-3<=0?0:e-3),t.child_product_pic){var i=n.goodsDetail.pic_list,o=i.findIndex((function(e){return e.pic===t.child_product_pic}));o>=0?n.swiperCurrent=o:(n.goodsDetail.pic_list.unshift({pic:t.child_product_pic}),n.swiperCurrent=0)}},getBuyShopCart:function(e,i){var o=this,a=o.goodsDetail,s=o.selectSpecsChild;if(n.globalData.user){if(a.specs_status&&!s)return t.showToast({title:"请选择商品规格",icon:"none"});if(s&&0===s.child_product_stock)return t.showToast({title:"选择的规格库存不足",icon:"none"});var c=function(){var n={id:a.id,number:o.buyNumber};if(s&&(n.spec=s.child_product_id),"buy"==e||"pintuan"==e||"joinPintuan"==e||"score"==e){var c={id:a.id,num:o.buyNumber,pic:a.pic_list[0].pic,shelve_status:a.shelve_status,stock_number:o.buyNumMax,title:a.title,active:!0,ctype:a.ctype};a.specs_list?(c.spec_id=o.selectSpecsChild.child_product_id,c.spec_name=o.propertyChildNames,c.mini_price=o.selectSpecsChild.child_product_price,c.mini_score=o.selectSpecsChild.child_product_score):(c.mini_price=a.mini_price,c.mini_score=a.mini_score),o.pintuanConfig&&(c.mini_price=o.selectSpecsChild.child_product_pintuan||a.pintuan_price),t.setStorage({key:"__ddminiShopCart",data:[c]});var r="/pages/order/paypal";return"pintuan"===e?r="/pages/order/paypal?type=pintuan":"joinPintuan"===e&&(r="/pages/order/paypal?type=pintuan&pintuanId="+i),void t.navigateTo({url:r})}o.Get(o.Url.cartAdd,n).then((function(e){0==e.code?(t.showToast({title:"加入成功"}),o.getCartList()):t.showModal({content:e.msg,showCancel:!1})}))};if("pintuan"===e){var r={goods_id:a.id};o.Get(o.Url.pintuanCheck,r).then((function(e){0===e.code?c():t.showModal({content:e.msg,showCancel:!1})}))}else c()}else t.navigateTo({url:"/pages/user/login"})},joinPintuanTap:function(e){var i=this;if(n.globalData.user){var o={goods_id:i.goodsDetail.id,tuan_id:e.id};i.Get(i.Url.pintuanCheck,o).then((function(n){0===n.code?i.getBuyShopCart("joinPintuan",e.id):t.showModal({content:n.msg,showCancel:!1})}))}else t.navigateTo({url:"/pages/user/login"})},getTotalTimeTap:function(t){var e=(new Date).getTime(),n=t-e;return console.log(n),n},swiperChange:function(t){this.swiperCurrent=t.detail.current},getPathTap:function(t){n.globalData.getPathTap(t)},getTimeTipsTap:function(){t.showModal({content:"限时抢购中，到期后将自动下架，时间有限，先到先得！",showCancel:!1})}}};e.default=i}).call(this,n("543d")["default"])},"28bf":function(t,e,n){"use strict";(function(t){n("d37c");i(n("66fd"));var e=i(n("668a"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},"59eb":function(t,e,n){"use strict";var i=n("8717"),o=n.n(i);o.a},"5dc8":function(t,e,n){"use strict";n.r(e);var i=n("20a1"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},"668a":function(t,e,n){"use strict";n.r(e);var i=n("8bb8"),o=n("5dc8");for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("59eb");var s,c=n("f0c5"),r=Object(c["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);e["default"]=r.exports},8717:function(t,e,n){},"8bb8":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}));var i={uCountDown:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-count-down/u-count-down")]).then(n.bind(null,"a4f8"))},aicon:function(){return n.e("components/aicon/aicon").then(n.bind(null,"6387"))},uParse:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-parse/u-parse")]).then(n.bind(null,"e6e7"))},uModal:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-modal/u-modal")]).then(n.bind(null,"49b2"))},shareCoverPic:function(){return n.e("components/shareCoverPic/shareCoverPic").then(n.bind(null,"bce2"))}},o=function(){var t=this,e=t.$createElement,n=(t._self._c,t.goodsDetail&&t.goodsDetail.pintuan_id&&t.pintuanGoodsList.length>0?t.__map(t.pintuanGoodsList,(function(e,n){var i=t.__get_orig(e),o=t.getTotalTimeTap(e.endtime_stamp);return{$orig:i,m0:o}})):null);t._isMounted||(t.e0=function(e){t.selectSpecsChild=""},t.e1=function(e){t.shareShow=!t.shareShow},t.e2=function(e){t.shareShow=!1},t.e3=function(e){t.shareCoverShow=!0,t.shareShow=!1},t.e4=function(e){t.shareCoverShow=!1}),t.$mp.data=Object.assign({},{$root:{l0:n}})},a=[]}},[["28bf","common/runtime","common/vendor"]]]);