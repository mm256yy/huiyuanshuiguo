(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/l-painter/l-painter"],{"2a88":function(e,t,n){"use strict";var r;n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return r}));var a=function(){var e=this,t=e.$createElement;e._self._c},i=[]},3462:function(e,t,n){"use strict";n.r(t);var r=n("2a88"),a=n("9452");for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);n("5f5e");var s,u=n("f0c5"),c=Object(u["a"])(a["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],s);t["default"]=c.exports},"5f5e":function(e,t,n){"use strict";var r=n("c0c4"),a=n.n(r);a.a},"7cea":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(n("a34a")),a=n("1110"),i=n("3682"),s=n("b6aa");function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n,r,a,i,s){try{var u=e[i](s),c=u.value}catch(o){return void n(o)}u.done?t(c):Promise.resolve(c).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){c(i,r,a,s,u,"next",e)}function u(e){c(i,r,a,s,u,"throw",e)}s(void 0)}))}}var d={name:"lime-painter",mixins:[(0,i.parent)("painter")],props:{board:Object,pathType:{type:String},fileType:{type:String,default:"png"},quality:{type:Number,default:1},css:[String,Object],width:[Number,String],height:[Number,String],pixelRatio:Number,customStyle:String,isCanvasToTempFilePath:Boolean,sleep:{type:Number,default:1e3/30},beforeDelay:{type:Number,default:100},afterDelay:{type:Number,default:100},type:{type:String,default:"2d"}},data:function(){return{use2dCanvas:!0,canvasHeight:150,canvasWidth:null,isDrawIng:!1,isPC:!1,inited:!1,name:"view",progress:0}},computed:{canvasId:function(){return"l-painter".concat(this._uid)},size:function(){if(this.boardWidth&&this.boardHeight)return"width:".concat(this.boardWidth,"px; height: ").concat(this.boardHeight,"px;")},dpr:function(){return this.pixelRatio||e.getSystemInfoSync().pixelRatio},boardWidth:function(){var e,t=this.width,n=void 0===t?0:t,r=this.canvasWidth,i=void 0===r?0:r,s=(null===(e=this.board)||void 0===e?void 0:e.css)||this.board||{},u=s.width,c=void 0===u?0:u;return Math.max((0,a.toPx)(n||c),(0,a.toPx)(i))},boardHeight:function(){var e,t=this.height,n=void 0===t?0:t,r=this.canvasHeight,i=void 0===r?0:r,s=(null===(e=this.board)||void 0===e?void 0:e.css)||this.board||{},u=s.height,c=void 0===u?0:u;return Math.max((0,a.toPx)(n||c),(0,a.toPx)(i))}},watch:{canvasWidth:function(e){var t;this.el.css&&!(null===(t=this.el.css)||void 0===t?void 0:t.width)&&(this.el.css.width=e)},size:function(e){this.use2dCanvas&&(this.inited=!1)}},created:function(){var t=e.getSystemInfoSync(),n=t.SDKVersion,r=t.version,i=t.platform,s=t.environment;this.isPC=/windows/i.test(i),this.use2dCanvas="2d"===this.type&&(0,a.compareVersion)(n,"2.9.2")>=0&&!(/ios/i.test(i)&&/7.0.20/.test(r)||/wxwork/i.test(s))&&!this.isPC},mounted:function(){var e=this;this.getParentWeith(),this.$nextTick((function(){setTimeout((function(){e.board?e.$watch("board",e.watchRender,{deep:!0,immediate:!0}):e.el.views.length&&e.$watch("el",e.watchRender,{deep:!0,immediate:!0})}),30)}))},methods:{watchRender:function(e){var t=this;return o(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.progress=0,"{}"!==JSON.stringify(e)&&e){n.next=3;break}return n.abrupt("return");case 3:clearTimeout(t.rendertimer),t.rendertimer=setTimeout((function(){t.render(e)}),t.beforeDelay);case 5:case"end":return n.stop()}}),n)})))()},setFilePath:function(e,t){var n=this;return o(r.default.mark((function i(){var s,u;return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(s=e,u=n.pathType,"base64"!=u||(0,a.isBase64)(e)){r.next=8;break}return r.next=5,(0,a.pathToBase64)(e);case 5:s=r.sent,r.next=12;break;case 8:if("url"!=u||!(0,a.isBase64)(e)){r.next=12;break}return r.next=11,(0,a.base64ToPath)(e);case 11:s=r.sent;case 12:return t&&n.$emit("success",s),r.abrupt("return",s);case 14:case"end":return r.stop()}}),i)})))()},getParentWeith:function(){var t=this;e.createSelectorQuery().in(this).select(".lime-painter").boundingClientRect().exec((function(e){t.canvasWidth=Math.ceil(e[0].width),t.canvasHeight=e[0].height||t.canvasHeight}))},update:function(e,t){var n=this;return o(r.default.mark((function i(){return r.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n.painter=null,n.use2dCanvas&&(n.ctx=null,n.inited=!1),n.isDrawIng=!1,r.next=5,new Promise((function(e){return n.$nextTick(e)}));case 5:return r.next=7,(0,a.sleep)(200);case 7:return r.abrupt("return",n.render(e,t));case 8:case"end":return r.stop()}}),i)})))()},render:function(){var e=arguments,t=this;return o(r.default.mark((function n(){var i,u,c,d,h,l,f,v,p,w,x,m,b;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(c=e.length>0&&void 0!==e[0]?e[0]:{},d=e.length>1&&void 0!==e[1]&&e[1],!t.isDrawIng){n.next=4;break}return n.abrupt("return",t.update(c,d));case 4:return t.isDrawIng=!0,"{}"!=JSON.stringify(c),n.next=8,t.getContext();case 8:if(h=n.sent,l=t.use2dCanvas,f=t.boardWidth,v=t.boardHeight,p=t.canvas,w=t.afterDelay,!l||p){n.next=12;break}return n.abrupt("return",Promise.reject(new Error("render: fail canvas has not been created")));case 12:return t.boundary={top:0,left:0,width:f,height:v},t.painter||(t.painter=new s.Painter({context:h,canvas:p,width:f,height:v,pixelRatio:t.dpr},t)),t.painter.listen("progressChange",(function(e){t.$emit("progress",e)})),n.next=17,t.painter.source(c);case 17:return x=n.sent,m=x.width,b=x.height,t.canvasHeight=(0,a.toPx)(null===(i=t.el.css)||void 0===i?void 0:i.height)||b,t.canvasWidth=(0,a.toPx)(null===(u=t.el.css)||void 0===u?void 0:u.width)||m,t.boundary.height=t.canvasHeight,t.boundary.width=t.canvasWidth,n.next=26,(0,a.sleep)(t.sleep);case 26:return n.next=28,t.painter.render();case 28:return n.next=30,new Promise((function(e){return t.$nextTick(e)}));case 30:if(l||d){n.next=33;break}return n.next=33,t.canvasDraw();case 33:if(!w||!l){n.next=36;break}return n.next=36,(0,a.sleep)(w);case 36:return t.$emit("done"),t.isCanvasToTempFilePath&&!d&&t.isDrawIng&&t.canvasToTempFilePath().then(function(){var e=o(r.default.mark((function e(n){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$emit("success",n.tempFilePath);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.$emit("fail",new Error(JSON.stringify(e)))})),t.isDrawIng=!1,n.abrupt("return",Promise.resolve({ctx:h,draw:t.painter,node:t.node}));case 40:case"end":return n.stop()}}),n)})))()},custom:function(e){var t=this;return o(r.default.mark((function n(){var a,i,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.render({},!0);case 2:return a=n.sent,i=a.ctx,s=a.draw,i.save(),n.next=8,e(i,s);case 8:return i.restore(),n.abrupt("return",Promise.resolve(!0));case 10:case"end":return n.stop()}}),n)})))()},single:function(){var e=arguments,t=this;return o(r.default.mark((function n(){var a,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:{},n.next=3,t.render(a,!0);case 3:return i=n.sent,n.abrupt("return",Promise.resolve(i));case 5:case"end":return n.stop()}}),n)})))()},canvasDraw:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(n,r){return e.ctx.draw(t,(function(){return setTimeout((function(){return n()}),e.afterDelay)}))}))},getContext:function(){var t=this;return o(r.default.mark((function n(){var a,i,s,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.ctx||!t.inited){n.next=2;break}return n.abrupt("return",Promise.resolve(t.ctx));case 2:if(a=t.type,i=t.use2dCanvas,s=t.dpr,t.boardWidth,t.boardHeight,u=function(){return new Promise((function(n){e.createSelectorQuery().in(t).select("#".concat(t.canvasId)).boundingClientRect().exec((function(r){if(r){var a=e.createCanvasContext(t.canvasId,t);t.inited||(t.inited=!0,t.use2dCanvas=!1,t.canvas=r),t.isPC&&a.scale(1/s,1/s),t.ctx=a,n(t.ctx)}}))}))},i){n.next=6;break}return n.abrupt("return",u());case 6:return n.abrupt("return",new Promise((function(n){e.createSelectorQuery().in(t).select("#".concat(t.canvasId)).node().exec((function(e){var r=e[0].node;r||(t.use2dCanvas=!1,n(t.getContext()));var i=r.getContext(a);t.inited||(t.inited=!0,t.use2dCanvas=!0,t.canvas=r),t.ctx=i,n(t.ctx)}))})));case 7:case"end":return n.stop()}}),n)})))()},canvasToTempFilePath:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=this.use2dCanvas,i=this.canvasId,s=this.dpr,u=this.fileType,c=this.quality;return new Promise((function(d,h){var l=t.boundary||t,f=l.top,v=void 0===f?0:f,p=l.left,w=void 0===p?0:p,x=l.width,m=l.height,b=x*s,g=m*s,y=function(){var e=o(r.default.mark((function e(n){var a;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.setFilePath(n.tempFilePath);case 2:a=e.sent,d(Object.assign(n,{tempFilePath:a}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=Object.assign({x:w,y:v,width:x,height:m,destWidth:b,destHeight:g,canvasId:i,fileType:u,quality:c,success:y,fail:h},n);a&&(delete P.canvasId,P.canvas=t.canvas),e.canvasToTempFilePath(P,t)}))}}};t.default=d}).call(this,n("543d")["default"])},9452:function(e,t,n){"use strict";n.r(t);var r=n("7cea"),a=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,(function(){return r[e]}))}(i);t["default"]=a.a},c0c4:function(e,t,n){}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/l-painter/l-painter-create-component',
    {
        'components/l-painter/l-painter-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("3462"))
        })
    },
    [['components/l-painter/l-painter-create-component']]
]);
